#
# play to create the cluster including the network, the disks,
# and the compute engine nodes
#
- hosts: localhost
  gather_facts: false
  strategy: free

  vars:
    num_cluster_nodes: 2

  tasks:
    - include_role:
        name: cluster
        tasks_from: create
        
  post_tasks:
    - shell: ./gce.py --refresh-cache
    - meta: refresh_inventory

# 
# play to provision the cluster nodes
#
- hosts: tag_cockroachdb-cluster-node
  gather_facts: false
  strategy: free

  pre_tasks:
    - include_role:
        name: sshserver
        tasks_from: wait-for-ssh

  roles:
    - ubuntu-node
    - cockroach-node